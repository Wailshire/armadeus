#!/bin/sh
#
# start/stop portmap daemon.

test -f /sbin/portmap || exit 0

OPTIONS=""

case "$1" in
    start)
	pid=`pidof portmap`
	if [ -n "$pid" ] ; then
	  echo "Not starting portmap daemon.  Already running."
	  exit 0
	fi
	echo -n "Starting portmap daemon:"
	echo -n " portmap"
	/sbin/portmap -- $OPTIONS
	echo "."

	sleep 1 # needs a short pause or pmap_set won't work. :(
	if [ -f /var/run/portmap.upgrade-state ]; then
	  echo -n "Restoring old RPC service information..."
	  pmap_set </var/run/portmap.upgrade-state
	  rm -f /var/run/portmap.upgrade-state
	  echo "done."
	else
	  if [ -f /var/run/portmap.state ]; then
	    pmap_set </var/run/portmap.state
	    rm -f /var/run/portmap.state
	  fi
	fi

	;;
    stop)
	;;
    reload)
	;;
    force-reload)
	$0 restart
	;;
    restart)
	$0 stop
	$0 start
	;;
    *)
	echo "Usage: /etc/init.d/portmap {start|stop|reload|restart}"
	exit 1
	;;
esac

exit 0

