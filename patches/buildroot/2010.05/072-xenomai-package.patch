diff -ruN buildroot/package/Config.in buildroot.new/package/Config.in
--- buildroot/package/Config.in	2009-03-09 16:57:56.000000000 +0100
+++ buildroot.new/package/Config.in	2009-02-24 11:33:56.000000000 +0100
@@ -210,6 +210,7 @@
 source "package/usbmount/Config.in"
 source "package/usbutils/Config.in"
 source "package/wipe/Config.in"
+source "package/xenomai/Config.in"
 source "package/xfsprogs/Config.in"
 endmenu
 
diff -urN buildroot/target/linux/Makefile.in.advanced buildroot.new/target/linux/Makefile.in.advanced
--- buildroot/target/linux/Makefile.in.advanced	2009-02-24 11:42:16.000000000 +0100
+++ buildroot.new/target/linux/Makefile.in.advanced	2009-02-24 11:40:07.000000000 +0100
@@ -373,6 +373,9 @@
 	$(SED) "s,^CROSS_COMPILE.*,CROSS_COMPILE=$(KERNEL_CROSS),g;" $(LINUX_DIR)/Makefile
 	(cd $(LINUX_DIR)/drivers; ln -sf $(ARMADEUS_TOPDIR)/target/linux/modules/ armadeus)
 endif
+ifeq ($(BR2_PACKAGE_XENOMAI),y)
+	make -C ../buildroot xenomai-patch-kernel
+endif
 	$(MAKE) $(LINUX26_MAKE_FLAGS) -C $(LINUX26_DIR) oldconfig
 	touch $@

